<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="7sDream">
        <link rel="canonical" href="http://django-intro-zh.readthedocs.org/glance/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>初识 Django - Django intro 中文版</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Django intro 中文版</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">介绍</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">文档 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li class="active">
                            <a href="./">初识 Django</a>
                        </li>
                    
                        <li >
                            <a href="../install/">快速安装指南</a>
                        </li>
                    
                        <li >
                            <a href="../part1/">第一个 Django 项目 - 第一部分</a>
                        </li>
                    
                        <li >
                            <a href="../part2/">第一个 Django 项目 - 第二部分</a>
                        </li>
                    
                        <li >
                            <a href="../part3/">第一个 Django 项目 - 第三部分</a>
                        </li>
                    
                        <li >
                            <a href="../part4/">第一个 Django 项目 - 第四部分</a>
                        </li>
                    
                        <li >
                            <a href="../part5/">第一个 Django 项目 - 第五部分</a>
                        </li>
                    
                        <li >
                            <a href="../part6/">第一个 Django 项目 - 第六部分</a>
                        </li>
                    
                        <li >
                            <a href="../whats_next/">下一步我该干什么</a>
                        </li>
                    
                        <li >
                            <a href="../reusable_app/">编写可重用的应用</a>
                        </li>
                    
                        <li >
                            <a href="../patch/">为 Django 贡献代码</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../install/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/7sDream/django-intro-zh">
                        
                        django-intro-zh
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#django">初识 Django</a></li>
        
            <li><a href="#_1">设计模型</a></li>
        
            <li><a href="#_2">创建模型</a></li>
        
            <li><a href="#api">享用便捷的 API</a></li>
        
            <li><a href="#_3">动态生成的管理页面：并非徒有其表</a></li>
        
            <li><a href="#url">规划 URL</a></li>
        
            <li><a href="#_4">编写视图</a></li>
        
            <li><a href="#_5">设计模板</a></li>
        
            <li><a href="#_6">这只是冰山一角</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="django">初识 Django</h1>
<p>Django 最初被设计用于具有快速开发需求的新闻类站点，目的是要实现简单快捷的网站开发。以下内容简要介绍了如何使用 Django 实现一个数据库驱动的 Web 应用。</p>
<p>为了让您充分理解 Django 的工作原理，这份文档为您详细描述了相关的技术细节，不过这并不是一份入门教程或者是参考文档（我们当然也为您准备了这些）。如果您想要马上开始一个项目，可以从<a href="../part1/">实例教程（zh）</a>开始入手，或者直接开始阅读详细的<a href="https://docs.djangoproject.com/en/1.8/topics/">参考文档</a>。</p>
<h2 id="_1">设计模型</h2>
<p>Django 无需数据库就可以使用，它提供了<a href="https://en.wikipedia.org/wiki/Object-relational_mapping">对象关系映射器（ORM）</a>。通过此技术，你可以使用 Python 代码来描述数据库结构。</p>
<p>你可以使用强大的<a href="https://docs.djangoproject.com/en/1.8/topics/db/models/">模型</a>来描述你的数据，这解决了数年以来在数据库模式中的难题。以下是一个简明的例子：</p>
<pre><code class="python3"># mysite/news/models.py

from django.db import models

class Reporter(models.Model):
    full_name = models.CharField(max_length=70)

    def __str__(self):              # Python 2 下请使用 __unicode__
        return self.full_name

class Article(models.Model):
    pub_date = models.DateField()
    headline = models.CharField(max_length=200)
    content = models.TextField()
    reporter = models.ForeignKey(Reporter)

    def __str__(self):              # Python 2 下请使用 __unicode__
        return self.headline
</code></pre>

<h2 id="_2">创建模型</h2>
<p>然后，运行 Django 命令行工具来创建数据库表。</p>
<pre><code class="bash">$ python manage.py migrate
</code></pre>

<p><a href="https://docs.djangoproject.com/en/1.8/ref/django-admin/#django-admin-migrate"><strong>migrate</strong></a> 命令会查找所有可用的模型，如果数据库中没有与之对应的表，则会为其自动创建。Django 也提供了其他<a href="https://docs.djangoproject.com/en/1.8/topics/migrations/">更丰富的控制方式</a>。</p>
<h2 id="api">享用便捷的 API</h2>
<p>接下来，你就可以使用一套便捷而丰富的 <a href="https://docs.djangoproject.com/en/1.8/topics/db/queries/">Python API</a> 用于访问你的数据。这些 API 是自动即时创建的，你不用编写其他任何代码。</p>
<pre><code class="pycon"># 从我们的 news 应用里导入模型（译注：记者和文章模型）。
&gt;&gt;&gt; from news.models import Reporter, Article

# 现在系统中还没有记者。
&gt;&gt;&gt; Reporter.objects.all()
[]

# 建立一个 Reporter 对象。
&gt;&gt;&gt; r = Reporter(full_name='John Smith')

# 将对象保存到数据库。save()方法需要被显式调用。
&gt;&gt;&gt; r.save()

# 现在它有了id。
&gt;&gt;&gt; r.id
1

# 现在这个新人记者已经在数据库里了。
&gt;&gt;&gt; Reporter.objects.all()
[&lt;Reporter: John Smith&gt;]

# 数据字段被表示成 Python 对象中的属性。
&gt;&gt;&gt; r.full_name
'John Smith'

# Django 提供了一套丰富的数据库查找 API。
&gt;&gt;&gt; Reporter.objects.get(id=1)
&lt;Reporter: John Smith&gt;
&gt;&gt;&gt; Reporter.objects.get(full_name__startswith='John')
&lt;Reporter: John Smith&gt;
&gt;&gt;&gt; Reporter.objects.get(full_name__contains='mith')
&lt;Reporter: John Smith&gt;
&gt;&gt;&gt; Reporter.objects.get(id=2)
Traceback (most recent call last):
  ...
DoesNotExist: Reporter matching query does not exist.

# 创建一篇文章。
&gt;&gt;&gt; from datetime import date
&gt;&gt;&gt; a = Article(pub_date=date.today(), headline='Django is cool',
...     content='Yeah.', reporter=r)
&gt;&gt;&gt; a.save()

# 现在文章在数据库里了。
&gt;&gt;&gt; Article.objects.all()
[&lt;Article: Django is cool&gt;]

# 通过 Article 对象可以访问与其关联的 Reporter 对象。
&gt;&gt;&gt; r = a.reporter
&gt;&gt;&gt; r.full_name
'John Smith'

# 反之亦然：Reporter 对象也可以访问到与其关联的 Article 对象。
&gt;&gt;&gt; r.article_set.all()
[&lt;Article: Django is cool&gt;]

# 这个 API 接受你所需的查询条件，并在后台高效地执行 JOIN 数据库操作。
# 这个操作会查找所有名为 &quot;John&quot; 的记者发表的文章。
&gt;&gt;&gt; Article.objects.filter(reporter__full_name__startswith='John')
[&lt;Article: Django is cool&gt;]

# 通过变更对象的属性值来修改对象，然后调用save()。
&gt;&gt;&gt; r.full_name = 'Billy Goat'
&gt;&gt;&gt; r.save()

# 用 delete() 来删除一个对象。
&gt;&gt;&gt; r.delete()
</code></pre>

<h2 id="_3">动态生成的管理页面：并非徒有其表</h2>
<p>当你的模型完成定义，Django 就会自动生成一个专业的生产级<a href="https://docs.djangoproject.com/en/1.8/ref/contrib/admin/">管理页面</a> - 一个可以认证用户添加、更改和删除对象的 Web 站点。你只需简单的在 admin 站点上注册你的模型即可。</p>
<pre><code class="python3"># mysite/news/models.py

from django.db import models

class Article(models.Model):
    pub_date = models.DateField()
    headline = models.CharField(max_length=200)
    content = models.TextField()
    reporter = models.ForeignKey(Reporter)
</code></pre>

<pre><code class="python3"># mysite/news/admin.py

from django.contrib import admin

from . import models

admin.site.register(models.Article)
</code></pre>

<p>这样设计所遵循的理念是，站点编辑人员可以是你的员工、你的客户、或者就是你自己——而你大概不会乐意去废半天劲创建一个只有内容管理功能的后台管理界面。</p>
<p>创建 Django 应用的典型流程是，先建立数据模型，然后搭建管理站点，之后你的员工（或者客户）就可以向网站里填充数据了。后面我们会谈到如何展示这些数据。</p>
<h2 id="url">规划 URL</h2>
<p>简洁优雅的 URL 规划对于一个高质量 Web 应用来说至关重要。Django 推崇优美的 URL 设计，所以不要把诸如 <strong>.php</strong> 和 <strong>.asp</strong> 之类的冗余的后缀放到 URL 里。</p>
<p>为了设计你自己的 URL，你需要创建一个叫做 <a href="https://docs.djangoproject.com/en/1.8/topics/http/urls/">URLconf</a> 的 Python 模块。这是网站的目录，它包含了一张 URL 和 Python 回调函数之间的映射表。URLconf 也有利于将 Python 代码与 URL 进行解耦（译注：使各个模块分离，独立）。</p>
<p>下面这个 URLconf 适用于前面 <strong>Reporter/Article</strong> 的例子：</p>
<pre><code class="python3"># mysite/news/urls.py

from django.conf.urls import url

from . import views

urlpatterns = [
    url(r'^articles/([0-9]{4})/$', views.year_archive),
    url(r'^articles/([0-9]{4})/([0-9]{2})/$', views.month_archive),
    url(r'^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$', views.article_detail),
]
</code></pre>

<p>上面的代码将 URL 的<a href="https://docs.python.org/howto/regex.html">正则表达式</a>映射到 views 里的回调函数。正则表达式通过括号来提取 URL 中的参数值。当一个用户请求页面时，Django 会遍历这些匹配模式，直至请求的 URL 被成功匹配。（如果 URL 无法匹配，Django 会返回一个404视图。）这个过程会在瞬间完成，因为这些正则表达式在启动时会被自动编译。</p>
<p>一旦正则表达式匹配成功，Django 会导入并调用指定的视图——一个简单地 Python 函数。每个视图都会接收到一个请求（requeset）对象——其中包含了请求元数据——同时还有正则表达式匹配到的那些值。</p>
<p>比如，如果用户请求了“/articles/2005/05/39323/”这样的 URL，Django 就会这样调用函数：<strong>news.views.article_detail(request, '2005', '05', '39323')</strong>。</p>
<h2 id="_4">编写视图</h2>
<p>视图函数的执行结果只可能有两种：返回一个包含请求页面元素的 <a href="https://docs.djangoproject.com/en/1.8/ref/request-response/#django.http.HttpResponse"><strong>HttpResponse</strong></a> 对象，或者是抛出 <a href="https://docs.djangoproject.com/en/1.8/topics/http/views/#django.http.Http404"><strong>Http404</strong></a> 这类异常。至于执行过程中的其他的动作则由你决定。</p>
<p>通常来说，一个视图的工作就是：从参数获取数据，装载一个模板，然后将根据获取的数据对模板进行渲染。下面是一个 <strong>year_archive</strong> 的视图样例：</p>
<pre><code class="python3"># mysite/news/views.py

from django.shortcuts import render

from .models import Article

def year_archive(request, year):
    a_list = Article.objects.filter(pub_date__year=year)
    context = {'year': year, 'article_list': a_list}
    return render(request, 'news/year_archive.html', context)
</code></pre>

<p>这个例子使用了 Django 的<a href="https://docs.djangoproject.com/en/1.8/topics/templates/">模板系统</a>，它有着很多强大的功能，而且使用起来足够简单，即使不是程序员也可轻松使用。</p>
<h2 id="_5">设计模板</h2>
<p>上面的代码加载了 <strong>news/year_archive.html</strong> 这个模板。</p>
<p>Django 允许设置搜索模板路径，这样可以最小化模板之间的冗余。在Django设置中，你可以通过 <a href="https://docs.djangoproject.com/en/1.8/ref/settings/#std:setting-TEMPLATES-DIRS"><strong>DIRS</strong></a> 参数指定一个路径列表用于检索模板。如果第一个路径中不包含任何模板，就继续检查第二个，以此类推。</p>
<p><strong>news/year_archive.html</strong> 模板可能是这样的：</p>
<pre><code class="html+django">{% extends &quot;base.html&quot; %}

{% block title %}Articles for {{ year }}{% endblock %}

{% block content %}
&lt;h1&gt;Articles for {{ year }}&lt;/h1&gt;

{% for article in article_list %}
    &lt;p&gt;{{ article.headline }}&lt;/p&gt;
    &lt;p&gt;By {{ article.reporter.full_name }}&lt;/p&gt;
    &lt;p&gt;Published {{ article.pub_date|date:&quot;F j, Y&quot; }}&lt;/p&gt;
{% endfor %}
{% endblock %}
</code></pre>

<p>我们看到变量都被双大括号括起来了。 <strong>{{ article.headline }}</strong> 的意思是“输出 <strong>article</strong> 的 <strong>headline</strong> 属性值”。这个“点”还有更多的用途，比如查找字典键值、索引和函数调用。</p>
<p>我们注意到 <strong>{{ article.pub_date|date:"F j, Y" }}</strong> 使用了 Unix 风格的“管道符”（“|”字符）。这是一个模板过滤器，用于过滤变量值。在这里过滤器将一个 Python <strong>datetime</strong> 对象转化为指定的格式（就像 PHP 中的日期函数那样）。</p>
<p>你可以将多个过滤器连在一起使用。你还可以使用你<a href="https://docs.djangoproject.com/en/1.8/howto/custom-template-tags/#howto-writing-custom-template-filters">自定义的模板过滤器</a>。你甚至可以自己编写<a href="https://docs.djangoproject.com/en/1.8/howto/custom-template-tags/">自定义的模板标签</a>，相关的 Python 代码会在使用标签时在后台运行。</p>
<p>Django 使用了“模板继承”的概念。这就是 <strong>{% extends "base.html" %}</strong> 的作用。它的含义是“先加载名为 base 的模板，并且用下面的标记块对模板中定义的标记块进行填充”。简而言之，模板继承可以使模板间的冗余内容最小化：每个模板只需包含与其他文档有区别的内容。</p>
<p>下面是 <strong>base.html</strong> 可能的样子，它使用了<a href="https://docs.djangoproject.com/en/1.8/howto/static-files/">静态文件</a>：</p>
<pre><code class="html+django"># mysite/templates/base.html

{% load staticfiles %}
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;img src=&quot;{% static &quot;images/sitelogo.png&quot; %}&quot; alt=&quot;Logo&quot; /&gt;
    {% block content %}{% endblock %}
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>简而言之，它定义了这个网站的外观（还有网站的 logo），并且给子模板们挖好了可以填的坑。这也让网站的改版变得简单无比——你只需更改这个根模板文件即可。</p>
<p>它也可以用来创建网站的多个版本，多个根模板可以重用同一套子模板。Django 的创始人就用这种技术建立了网站的移动端适配版——只需建立一个新的根模板。</p>
<p>注意，你并不是非得使用 Django 的模板系统，你可以使用其他你喜欢的模板系统。尽管 Django 的模板系统与其模型层能够集成得很好，但这不意味着你必须使用它。同样，你可以不使用 Django 的数据库 API。你可以用其他的数据库抽象层，像是直接读取 XML 文件，亦或直接读取磁盘文件，你可以使用任何方式。Django 的任何组成——模型、视图和模板——都是独立的。</p>
<h2 id="_6">这只是冰山一角</h2>
<p>以上只是 Django 的功能性概述。Django 还有更多实用的特性：</p>
<ul>
<li><a href="https://docs.djangoproject.com/en/1.8/topics/cache/">缓存框架</a>可以与 memcached 或其他后端集成。</li>
<li><a href="https://docs.djangoproject.com/en/1.8/ref/contrib/syndication/">聚合器框架</a>可以通过简单编写一个 Python 类来推送 RRS 和 Atom。</li>
<li>更多令人心动的自动化管理功能：概述里面仅仅浅尝辄止。</li>
</ul>
<p>接下来您可以<a href="https://www.djangoproject.com/download/">下载 Django</a>，阅读<a href="../part1/">实例教程（zh）</a>，然后加入<a href="https://www.djangoproject.com/community/">Django 社区</a>！感谢您的关注！</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>